<html><!-- #BeginTemplate "/Templates/features - article.dwt" -->
<head>
<!-- #BeginEditable "doctitle" --> 
<title>Gamasutra - Features - &quot;Real-time Shadow Casting Using Shadow Volumes&quot; [11.15.99]</title>
<!-- #EndEditable --> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<SCRIPT language=javascript1.1>
<!--
function OnTopWindow(winwidth,winheight,file_name) {
	TopWindow = window.open(file_name,"Media","toolbar=no,width=" +
winwidth + ",height=" + winheight + ",directories=no,status=yes,scrollbars=no,resize=no,menubar=no")
}
//  -->
</SCRIPT>
<script language="JavaScript">
<!--
function MM_preloadImages() { //v2.0
  if (document.images) {
    var imgFiles = MM_preloadImages.arguments;
    if (document.preloadArray==null) document.preloadArray = new Array();
    var i = document.preloadArray.length;
    with (document) for (var j=0; j<imgFiles.length; j++) if (imgFiles[j].charAt(0)!="#"){
      preloadArray[i] = new Image;
      preloadArray[i++].src = imgFiles[j];
  } }
}

function MM_swapImgRestore() { //v2.0
  if (document.MM_swapImgData != null)
    for (var i=0; i<(document.MM_swapImgData.length-1); i+=2)
      document.MM_swapImgData[i].src = document.MM_swapImgData[i+1];
}

function MM_swapImage() { //v2.0
  var i,j=0,objStr,obj,swapArray=new Array,oldArray=document.MM_swapImgData;
  for (i=0; i < (MM_swapImage.arguments.length-2); i+=3) {
    objStr = MM_swapImage.arguments[(navigator.appName == 'Netscape')?i:i+1];
    if ((objStr.indexOf('document.layers[')==0 && document.layers==null) ||
        (objStr.indexOf('document.all[')   ==0 && document.all   ==null))
      objStr = 'document'+objStr.substring(objStr.lastIndexOf('.'),objStr.length);
    obj = eval(objStr);
    if (obj != null) {
      swapArray[j++] = obj;
      swapArray[j++] = (oldArray==null || oldArray[j-1]!=obj)?obj.src:oldArray[j];
      obj.src = MM_swapImage.arguments[i+2];
  } }
  document.MM_swapImgData = swapArray; //used for restore
}
//-->
</script>
<body bgcolor="#FFFFCC" link="#880000" vlink="#000000" ONLOAD="MM_preloadImages('../../db_area/images/layout/99join_on.gif','#920582065544');MM_preloadImages('../../db_area/images/layout/99help_on.gif','#920582346659');MM_preloadImages('../../db_area/images/layout/99contact_on.gif','#920582404742');MM_preloadImages('../../db_area/images/layout/99shop_on.gif','#920583266882');MM_preloadImages('../../db_area/images/layout/99search_on.gif','#920592177354');MM_preloadImages('../../db_area/images/layout/99news_on.gif','#920515198692');MM_preloadImages('../../db_area/images/layout/99features_on.gif','#920516131613');MM_preloadImages('../../db_area/images/layout/99connect_on.gif','#920516339983');MM_preloadImages('../../db_area/images/layout/99job_on.gif','#920516860121');MM_preloadImages('../../db_area/images/layout/99direct_on.gif','#920516953545')" ALINK="#880000">
<!-- #BeginLibraryItem "/Library/99_ads.lbi" --><table width="599" border="0" cellspacing="0" cellpadding="0" height="68">
  <tr> 
    <td width="468" height="60" align="left"><!-- begin main ad tag --><A HREF="http://sally.songline.com:80/@KLJteS14TzN0aDBFYEFvwWzJwWLv9m2Cr0dsk4dtT3ZhaicrZVhJbmLvRTEVUWLZ42hZ44DAa4LXMNdiRyBSO0dsk4dtT3ZhaicQw49hrhZjbn2hP49jb4-fw4zs?"><IMG SRC="http://sally.songline.com:80/@GbTBTT1vnje_u7dfY-Yvk4Voam2yaWhvbiDSbGhlk0DWZXIupW9Zk4ctb0Uzd2dt42hZ42hvQX-t2yByw8aCQyLSbGhlk0DWZXIuUG-NZpc4w4zVZTVNw4VjXW-sb-dt?" WIDTH=468 HEIGHT=60 ALT="Miller Freeman Game Group Research" BORDER=0></A></td>
    <td align="right" height="60" ><!-- begin main ad tag --><A HREF="http://sally.songline.com:80/@PQFO1l1j8Xz_ZUA5Y-wvwWzJwWLv9m2Cr0dsk4dtT3ZhaicrZVhJblRR4EEyb-jZ42hZr2-A9n9XRSjhU2hZO0dsk4dtT3ZhaicQw49hrhZjbn2hP49jb4-fMTIoeSwoXW-sb--A?"><IMG SRC="http://sally.songline.com:80/@nR5KHl18rmquX3vaY-avk4Voam2yaWhvbiDSbGhlk0DWZXIupW9Zk450U2jAMWzw42hZ4pVRQXR320Q5Z2-Z4TLSbGhlk0DWZXIuUG-NZpc4w4zVZTVNw4VjXyECMngWM-DjbGzR?" WIDTH=120 HEIGHT=60 ALT="<ad>Connection</ad>" BORDER=0></A></td>
  </tr>
</table>
<!-- #EndLibraryItem --> <!-- #BeginLibraryItem "/Library/99top_nav.lbi" --><table width="600" border="0" height=60 cellspacing="0" cellpadding="0">
  <tr> 
    <td colspan=3><font face="Verdana, Arial, Helvetica, sans-serif" size="1" color="#990000"><b><i>&nbsp;&nbsp;Miller 
      Freeman Game Group Presents:<map name="gamahome">
        <area shape="rect" coords="4,3,131,54" href="/index.htm" alt="Home">
      </map></i></b></font></td>
  </tr>
  <tr> 
    <td rowspan="2" width="209" height="60"> <img src="/db_area/images/layout/99gamalogo.gif" width="209" height="60" border="0" usemap="#gamahome"></td>
    <td bgcolor="#000000" width="182" height=23>&nbsp;</td>
    <td bgcolor="#000000" align="right" width="209"> <a href="/cgi-bin/join.pl" onMouseOver="MM_preloadImages('/db_area/images/layout/99join_off.gif');MM_swapImage('document.Join','document.Join','/db_area/images/layout/99join_on.gif','#920582065544')" onMouseOut="MM_swapImgRestore()"> 
      <img src="/db_area/images/layout/99join_off.gif" width="40" height="23" border="0" name="Join" alt="Join"></a><img src="/db_area/images/layout/99vert_bar.gif" width="1" height="23"><a href="/help/index.htm" onMouseOver="MM_preloadImages('/db_area/images/layout/99help_off.gif');MM_swapImage('document.Help','document.Help','/db_area/images/layout/99help_on.gif','#920582346659')" onMouseOut="MM_swapImgRestore()"><img src="/db_area/images/layout/99help_off.gif" width="41" height="23" name="Help" border="0" alt="Help"></a><img src="/db_area/images/layout/99vert_bar.gif" width="1" height="23"><a href="/contact_us/index.htm" onMouseOver="MM_preloadImages('/db_area/images/layout/99help_off.gif');MM_swapImage('document.Contact','document.Contact','/db_area/images/layout/99contact_on.gif','#920582404742')" onMouseOut="MM_swapImgRestore()"><img src="/db_area/images/layout/99contact_off.gif" width="78" height="23" name="Contact" border="0" alt="Contact Us"></a><img src="/db_area/images/layout/99vert_bar.gif" width="1" height="23"><a href="/store/index.htm" onMouseOver="MM_preloadImages('/db_area/images/layout/99shop_off.gif');MM_swapImage('document.Shop','document.Shop','/db_area/images/layout/99shop_on.gif','#920583266882')" onMouseOut="MM_swapImgRestore()"><img src="/db_area/images/layout/99shop_off.gif" width="44" height="23" name="Shop" border="0" alt="Shop"></a></td>
  </tr>
  <tr> 
    <td bgcolor="#99CCOO" height=37 colspan=2 align="center"> 
      <table height=37 cellpadding=0 cellspacing=0 border="0" width="90%">
        <form method="post" action="/unisearch/" name="unisearchform">
          <tr valign="bottom"> 
            <td valign="middle"><!-- #BeginLibraryItem "/Library/99top_navsearch.lbi" --><font size="2" face="Arial, Helvetica">
<select name="searchfocus">
  <option value="cgi-bin/AT-editorialsearch.cgi">Editorial</option>
  <option value="cgi-bin/AT-jobsearchsearch.cgi">Job Search</option>
  <option value="connection" selected>---Connection---</option>
  <option value="members">Find a Member</option>
  <option value="events">Events</option>
  <option value="directories">---Directories---</option>
  <option value="companies">Companies</option>
  <option value="products">Products</option>
  <option value="resources">Resources</option>
</select>
<img src="/db_area/images/layout/99arrow.gif" width="15" height="14"> 
<input type="text" name="searchquery" size="12" value="">
</font>
<!-- #EndLibraryItem --></td>
            <td valign="middle"> 
              <input type="image" border="0" name="Search" src="/db_area/images/layout/99search.gif" width="57" height="23" alt="Search">
            </td>
          </tr>
        </form>
      </table>
    </td>
  </tr>
</table>
<!-- #EndLibraryItem --> 
<table width="600" border="0" cellspacing="0" cellpadding="0">
  <tr> 
    <td width="150" valign="top" height="157"> <!-- #BeginLibraryItem "/Library/99side_nav.lbi" --><IMG SRC="/db_area/images/layout/99underlogo.gif" WIDTH="149" HEIGHT="18"><BR>
<A HREF="/newswire/index.htm" ONMOUSEOVER="MM_preloadImages('/db_area/images/layout/99news_off.gif');MM_swapImage('document.NewsWire','document.NewsWire','/db_area/images/layout/99news_on.gif','#920515198692')" ONMOUSEOUT="MM_swapImgRestore()"><IMG SRC="/db_area/images/layout/99news_off.gif" WIDTH="149" HEIGHT="25" NAME="NewsWire" BORDER="0" ALT="Newswire"></A><BR>
<A HREF="/features/index.htm" ONMOUSEOVER="MM_preloadImages('/db_area/images/layout/99features_off.gif');MM_swapImage('document.Features','document.Features','/db_area/images/layout/99features_on.gif','#920516131613')" ONMOUSEOUT="MM_swapImgRestore()"><IMG SRC="/db_area/images/layout/99features_off.gif" WIDTH="149" HEIGHT="27" NAME="Features" BORDER="0" ALT="Features"></A><BR>
<A HREF="/connection/index.htm" ONMOUSEOVER="MM_preloadImages('/db_area/images/layout/99features_off.gif');MM_swapImage('document.Connection','document.Connection','/db_area/images/layout/99connect_on.gif','#920516339983')" ONMOUSEOUT="MM_swapImgRestore()"><IMG SRC="/db_area/images/layout/99connect_off.gif" WIDTH="149" HEIGHT="26" NAME="Connection" BORDER="0" ALT="Connection"></A><BR>
<A HREF="/jobsearch/index.htm" ONMOUSEOVER="MM_preloadImages('/db_area/images/layout/99job_off.gif');MM_swapImage('document.JobSearch','document.JobSearch','/db_area/images/layout/99job_on.gif','#920516860121')" ONMOUSEOUT="MM_swapImgRestore()"><IMG SRC="/db_area/images/layout/99job_off.gif" WIDTH="149" HEIGHT="27" NAME="JobSearch" BORDER="0" ALT="Job Search"></A><BR>
<A HREF="/directories/index.htm" ONMOUSEOVER="MM_preloadImages('/db_area/images/layout/99direct_off.gif');MM_swapImage('document.Directories','document.Directories','/db_area/images/layout/99direct_on.gif','#920516953545')" ONMOUSEOUT="MM_swapImgRestore()"><IMG SRC="/db_area/images/layout/99direct_off.gif" WIDTH="149" HEIGHT="34" NAME="Directories" BORDER="0" ALT="Directories"></A>
<!-- #EndLibraryItem --><br> 
<table width="125" border="0" cellspacing="0" cellpadding="0"> <tr> <td height="12"></td></tr> 
<tr valign="top"> 
          <td><!-- #BeginEditable "sidebar" --> 
            <div align="left"> 
              <p align="left"><font face="Arial, Helvetica, sans-serif" size="-1" color="99000"><b><i>by 
                Jason Bestimt and Bryant Freitag</i></b></font><br>
                <font face=arial,helvetica size=-1><b>Gamasutra</b><br>
                <i>November 15, 1999</i></font></p>
            </div>
            <p><b><img src="../../db_area/images/layout/99_side_features.gif" width="120" height="317"></b></p>
            <!-- #EndEditable --></td>
        </tr> </table></td>
    <td valign="top" WIDTH="450"> 
      <p align="center"><IMG SRC="../../db_area/images/layout/99_head_features.gif" WIDTH="146" HEIGHT="47" ALT="Features"><BR>
        <IMG SRC="../../db_area/images/layout/99_body_divider.gif" WIDTH="445" HEIGHT="5"></p>
      <!-- #BeginEditable "title" --><!-- #EndEditable --> <!-- #BeginEditable "main%20content" --> 
      <div align="left"> 
        <p align="center"><font face="Arial, Helvetica, sans-serif"><b>Real-Time 
          Shadow Casting Using Shadow Volumes</b></font></p>
        <table width="168" border="0" cellspacing="0" cellpadding="6" align="right" vspace="4" hspace="4">
          <tr align="center" bgcolor="#000000"> 
            <td><font size="-1" face="Arial, Helvetica, sans-serif" color="ffffcc"><b>Contents</b></font></td>
          </tr>
          <tr> 
            <td bgcolor="cccc99" height="186"> 
              <p><img src="../../db_area/images/layout/99_icon_arrow.gif" width="6" height="9"> 
                <font face="Arial, Helvetica, sans-serif" size="-1"><b> <a href="bestimt_freitag_01.htm">Real-Time 
                Dynamic Shadow-Casting</a></b></font></p>
              <p><img src="../../db_area/images/layout/99_icon_arrow.gif" width="6" height="9"> 
                <font face="Arial, Helvetica, sans-serif" size="-1"><b> Implementations 
                / Pros and Cons</b></font></p>
              <div align="left"> 
                <p align="left"><img src="../../db_area/images/layout/99_icon_arrow.gif" width="6" height="9"> 
                  <a href="bestimt_freitag_03.htm"><font face="Arial, Helvetica, sans-serif" size="-1"><b>The 
                  Path to Enlightenment</b></font></a></p>
              </div>
            </td>
          </tr>
        </table>
        <p align="left"><font face="Arial, Helvetica, sans-serif"><b>Implementation: 
          Birth of a Shadow Volume</b></font></p>
        <p><font face="Arial, Helvetica, sans-serif">The first step in creating 
          a shadow volume is to develop an effective method for identifying the 
          shadowing edges of any object. Among the many available techniques for 
          determining the edges, we discovered that the quickest method entails 
          generating face connectivity information before runtime. Connectivity 
          data is stored as an internal list of all neighboring faces for every 
          triangle. Listing 1 shows pseudo-code that suggests how to generate 
          the connectivity. This can be accomplished either during the loading 
          of the model, or the data can be preprocessed and stored into the file 
          format. Once this information is available, an application can efficiently 
          determine boundary edges of an object. Edges are determined by culling 
          faces that are not viewable from the current light perspective, and 
          then identifying edges that lie along the boundary of the culled and 
          not-culled faces. Listing 2 shows the pseudo-code that represents this 
          routine. Source code for all methods described in this article can be 
          found in the demo project, which is downloadable from the <i>Game Developer</i> 
          website.</font></p>
        <table width="93%" border="1" cellspacing="0" cellpadding="2" align="center">
          <tr bgcolor="#000000"> 
            <td><font face="Courier New, Courier, mono" size="-1" color="#FFFFFF"><b>Allocate 
              the memory for the connectivity data (one structure per face) </b></font> 
              <p><b><font face="Courier New, Courier, mono" size="-1" color="#FFFFFF">For 
                (a = every face) <br>
                {<br>
                &nbsp;&nbsp;//Edge 0 <br>
                &nbsp;&nbsp;If ( The first edge does not already have a neighbor 
                )<br>
                &nbsp;&nbsp;For (b = every other face)<br>
                &nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;If ( The first edge of a = any edge in 
                b )<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;They are neighbors !!!<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Quit looking for a neighbor 
                for this edge<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;}<BR>
                &nbsp;&nbsp;<br>
                &nbsp;&nbsp;Do the same for Edge 1 <br>
                &nbsp;&nbsp;Do the same for Edge 2<br>
                }</font></b></p>
            </td>
          </tr>
          <tr bgcolor="#000000"> 
            <td> 
              <div align="center"><font face="Arial, Helvetica, sans-serif" size="-1" color="#FFFFFF"><b>Listing 
                1. Generating the connectivity</b></font></div>
            </td>
          </tr>
        </table>
        <br>
        <table width="93%" border="1" cellspacing="0" cellpadding="2">
          <tr bgcolor="#000000"> 
            <td><font color="#FFFFFF"> <font face="Courier New, Courier, mono" size="-1"><b>Light 
              Direction = Direction of the light in the object's local space </b></font></font> 
              <p><b><font color="#FFFFFF" face="Courier New, Courier, mono" size="-1">Extension 
                Vector = Light Direction * &quot;Infinity&quot; // Length of the 
                shadow volume</font></b></p>
              <p><b><font color="#FFFFFF" face="Courier New, Courier, mono" size="-1">///////////////////////////////////////////////////////</font></b></p>
              <p><b><font color="#FFFFFF" face="Courier New, Courier, mono" size="-1">For 
                ( f = Every face in the Mesh )<br>
                {<br>
                &nbsp;&nbsp;if ( Face Normal * Light Direction = Visible )<br>
                &nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;Face is not culled<br>
                &nbsp;&nbsp;}<br>
                &nbsp;&nbsp;else<br>
                &nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;Face is culled<br>
                &nbsp;&nbsp;}<br>
                }</font></b></p>
              <p><b><font color="#FFFFFF" face="Courier New, Courier, mono" size="-1">//////////////////////////////////////////////////////</font></b></p>
              <p><b><font color="#FFFFFF" face="Courier New, Courier, mono" size="-1">For 
                ( f = Every face in the Mesh )<br>
                {<br>
                &nbsp;&nbsp;if ( f = visible )<br>
                &nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;if (( f's first edge does not have a neighbor 
                ) OR (f's first &nbsp;edge neighbor is NOT visible))<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// This is a shadow casting 
                edge<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add vertex 0<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add vertex 0 + Extension Vector<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add vertex 1<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add vertex 1 + Extension Vector<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add 2 faces<br>
                &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;Do the same for edge 1<br>
                &nbsp;&nbsp;&nbsp;&nbsp;Do the same for edge 2<br>
                &nbsp;&nbsp;}</font></b><font color="#FFFFFF" face="Courier New, Courier, mono" size="-1"><br>
                <b>}</b></font> </p>
              </td>
          </tr>
          <tr bgcolor="#000000"> 
            <td> 
              <div align="center"><font face="Arial, Helvetica, sans-serif" size="-1" color="#FFFFFF"><b>Listing 
                2. Generating Silhouette Information</b></font></div>
            </td>
          </tr>
        </table>
        <p><font face="Arial, Helvetica, sans-serif">After the boundary edges 
          have been detected, polygons can be generated to form the actual shadow 
          volume. This can be accomplished simply, or it can be a more difficult 
          task, depending on the approach. At the most basic level, two new vertices 
          need to be created in the direction of the light, away from the vertices 
          of the current edge. With the resulting four points, two simple triangles 
          can be formed. A number of complexities arise depending on how far you 
          want to extend the new points. </font></p>
        <p><font face="Arial, Helvetica, sans-serif">Three possible implementations 
          are as follows:</font></p>
        <p><font face="Arial, Helvetica, sans-serif"> 
          <ol>
            <li><i>Extend the edges a sufficient distance to guarantee extension 
              beyond the view frustum (a.k.a. the Brute Force approach).</i> Listing 
              2 shows an example of this method.<br>
              <br>
              <font face="Arial, Helvetica, sans-serif">While this method works 
              perfectly well, two performance concerns should be noted. First, 
              the graphics hardware or custom clip code will be forced to clip 
              these polygons. This may result in potential performance problems. 
              Second, the shadow volume polygons generated in this manner will 
              pierce all of the geometry in the scene. Depending on the extent 
              of your shadowing, this can be a good thing or a bad thing. Refer 
              to item 2 for further information&#133;<br>
              <br>
              </font></li>
            <li><font face="Arial, Helvetica, sans-serif"><i>Clip the shadow volume 
              vertices upon contact with scene geometry.</i><br>
              <br>
              </font><font face="Arial, Helvetica, sans-serif">This approach is 
              useful if you are not shadowing every object in your scene. Refer 
              to Figure 3 for an example of this method. For example, if an object 
              is located on one side of a wall, and the current view shows the 
              other side as well, the object's shadow will normally penetrate 
              the wall (if you are using method #1). This technique is perfectly 
              fine, <i>as long as the wall also generates a shadow</i>.<br>
              <br>
              </font>
              
            <table width="46%" border="0" cellspacing="0" cellpadding="3" align="right" hspace="2">
              <tr bgcolor="#000000"> 
                  <td> 
                    <div align="center"><img src="shadow_03.jpg" width="250" height="188"></div>
                  </td>
                </tr>
                <tr bgcolor="#000000"> 
                  <td height="39"> 
                    <div align="center"><font face="Arial, Helvetica, sans-serif" size="-1"><b><font color="#FFFFFF">Figure 
                      3. </font><font face="Arial, Helvetica, sans-serif"><font face="Arial, Helvetica, sans-serif"><font color="#FFFFFF">Clipping 
                      the shadow<br>
                      volume vertices upon<br>
                      contact with scene geometry.</font></font></font></b></font></div>
                  </td>
                </tr>
              </table>
              <font face="Arial, Helvetica, sans-serif"> </font> <font face="Arial, Helvetica, sans-serif">Using 
              this technique, no artifacts will be visible to the viewer as long 
              as every object in the scene is shadowed. In this example, if the 
              application was not creating shadows for the walls, the shadows 
              from each object would have to be clipped to the plane of the wall 
              to avoid artifacts. Keep in mind that if the scene-clipping method 
              was used, and the wall had a hole in it, the shadow would not pierce 
              through the hole using this method alone. Further computation must 
              be performed to accomplish this properly.<br>
              <br>
              </font></li>
            <li><font face="Arial, Helvetica, sans-serif"> <i>Clip the shadow 
              volume to the view frustum.</i></font><br>
              <br>
              <font face="Arial, Helvetica, sans-serif">This approach is a variation 
              of the edge-extension method previously described. The technique 
              avoids the performance hits that come from depending on the hardware 
              for clipping. However, the same problems mentioned for the previous 
              method will still exist. </font></li>
          </ol>
          
        </font> 
        <p><font face="Arial, Helvetica, sans-serif"><b>Implementation: The Baby 
          Grows Up</b></font></p>
        <p><font face="Arial, Helvetica, sans-serif">Once the shadow volume has 
          been generated and stored in memory, the real fun begins. As mentioned 
          in the overview, the volume must be rendered in its entirety to the 
          stencil buffer only; no color information should be displayed. Listing 
          3 shows the Direct3D implementation of the appropriate renderstate settings. 
          The polygons are rendered in flat shading mode, as we do not want the 
          card to waste cycles on gouraud shading that will never be displayed. 
          The stencil buffer values are incremented for every pixel that the card 
          renders during this pass.</font></p>
        <table width="89%" border="1" cellspacing="0" cellpadding="2" align="center">
          <tr bgcolor="#000000"> 
            <td><font color="#FFFFFF" face="Courier New, Courier, mono"><b><font size="-1">//Draw 
              the volume opening side<br>
              dev-&gt;SetRenderState(D3DRENDERSTATE_STENCILPASS, D3DSTENCILOP_INCR);<br>
              dev-&gt;SetRenderState(D3DRENDERSTATE_CULLMODE, D3DCULL_CCW);<br>
              dev-&gt;DrawIndexedPrimitive <br>
              { <br>
              &nbsp;&nbsp;D3DPT_TRIANGLELIST, <br>
              &nbsp;&nbsp;D3DFVF_VERTEX,<br>
              &nbsp;&nbsp;VtxPool,<br>
              &nbsp;&nbsp;vnum,<br>
              &nbsp;&nbsp;FaceList,<br>
              &nbsp;&nbsp;fnum,<br>
              &nbsp;&nbsp;0<br>
              };<br>
              <br>
              //Draw the volume closing side<br>
              dev-&gt;SetRenderState(D3DRENDERSTATE_CULLMODE, D3DCULL_CW);<br>
              dev-&gt;SetRenderState(D3DRENDERSTATE_STENCILPASS, D3DSTENCILOP_DECR);<br>
              dev-&gt;DrawIndexedPrimitive <br>
              { <br>
              &nbsp;&nbsp;D3DPT_TRIANGLELIST, <br>
              &nbsp;&nbsp;D3DFVF_VERTEX,<br>
              &nbsp;&nbsp;VtxPool,<br>
              &nbsp;&nbsp;vnum,<br>
              &nbsp;&nbsp;FaceList,<br>
              &nbsp;&nbsp;fnum,<br>
              &nbsp;&nbsp;0<br>
              };</font></b></font></td>
          </tr>
          <tr bgcolor="#000000"> 
            <td> 
              <div align="center"><font face="Arial, Helvetica, sans-serif" size="-1" color="#FFFFFF"><b>Listing 
                3. D3D shadow volume rendering</b></font></div>
            </td>
          </tr>
        </table>
        <p><font face="Arial, Helvetica, sans-serif">Just when you thought your 
          volume rendering days were over, we must make another render pass using 
          the same polygons. This time we must really shake up the natural order 
          of the universe and reverse the cull mode, as well. Listing 3 shows 
          the Direct3D implementation for setting the appropriate second-pass 
          rendering. Note the changes in the stencil functionality, as well as 
          the cull mode reversal. The volume is then rendered to the stencil buffer 
          in the same style as the first pass, but this time decrementing the 
          stencil values rather than incrementing them. Remember to set the Z-buffer, 
          stencil buffer, and cullmode back to their proper settings before proceeding 
          to render the next scene.</font></p>
        <p><font face="Arial, Helvetica, sans-serif">The application must repeat 
          the volume generation and rendering for every shadowed object, for the 
          current light, before rendering the actual shadow. This not only increases 
          performance (since rendering the true shadows can be costly, as we will 
          soon find out), but this method avoids creating multi-darkened artifacts 
          in the shadows. </font></p>
        <p><font face="Arial, Helvetica, sans-serif">At this point, the visual 
          representation of the shadow can be rendered. The principle is very 
          simple. Two large, gray, alpha-blended triangles are rendered to the 
          entire screen. The stencil operations are set to only render pixels 
          that have a corresponding positive value in the stencil buffer. Listing 
          4 shows the renderstates used to accomplish this operation. </font></p>
        <table width="88%" border="1" cellspacing="0" cellpadding="2" align="center">
          <tr bgcolor="#000000"> 
            <td height="414"><font color="#FFFFFF" face="Courier New, Courier, mono"><b><font size="-1">static 
              D3DTLVERTEX box[4];<br>
              static WORD box_faces[6] = {0,2,1,0,3,2};<br>
              static bool first = true;<br>
              static DWORD color = 0x00E0E0E0;</font></b></font> 
              <p><b><font color="#FFFFFF" size="-1" face="Courier New, Courier, mono">m_dev-&gt;SetRenderState(D3DRENDERSTATE_SRCBLEND, 
                D3DBLEND_DESTCOLOR);<br>
                m_dev-&gt;SetRenderState(D3DRENDERSTATE_DESTBLEND, D3DBLEND_ZERO);<br>
                m_dev-&gt;SetRenderState(D3DRENDERSTATE_STENCILFUNC, D3DCMP_LESSEQUAL);<br>
                m_dev-&gt;SetRenderState(D3DRENDERSTATE_STENCILPASS, D3DSTENCILOP_ZERO);</font></b></p>
              <p><b><font color="#FFFFFF" size="-1" face="Courier New, Courier, mono">if 
                (first)<br>
                {<br>
                &nbsp;&nbsp;first = false;<br>
                &nbsp;&nbsp;Zero Memory for vertices<br>
                &nbsp;&nbsp;Assign 4 vertices to the 4 corners of your screen<br>
                }</font></b></p>
              <p><b><font color="#FFFFFF" size="-1" face="Courier New, Courier, mono">m_dev-&gt;DrawIndexedPrimitive(D3DPT_TRIANGLELIST, 
                D3DFVF_TLVERTEX,<br>
                &nbsp;&nbsp;box, 4, box_faces, 6,<br>
                &nbsp;&nbsp;D3DDP_DONOTCLIP);</font></b></p>
            </td>
          </tr>
          <tr bgcolor="#000000"> 
            <td> 
              <div align="center"><font face="Arial, Helvetica, sans-serif" size="-1" color="#FFFFFF"><b>Listing 
                4. D3D shadow fill rendering</b></font></div>
            </td>
          </tr>
        </table>
        <p><font face="Arial, Helvetica, sans-serif"><b>The Darkness and the Light: 
          Pros and Cons</b><br>
          <br>
          Employing shadow casting in real-time 3D interactive environments, using 
          the techniques we've presented in this article, has both advantages 
          and disadvantages. In this section, we will consider both. Positive 
          benefits include greatly improved realism, achieved without requiring 
          texture manipulation or undue loss of rendering speed. On the negative 
          side, the programmer must deal with stencil buffer support, fill-rate 
          limitations, sharp shadows, small polygon anomalies, and advanced scene-management 
          concerns.</font></p>
        <p><font face="Arial, Helvetica, sans-serif">Greatly improved realism 
          is the most significant gain offered by real-time shadow casting. When 
          you use full shadow casting, an entire scene behaves realistically with 
          any number of polygons and objects. Scenes can be completely dynamic, 
          with no previous lighting calculations necessary (excluding the connectivity 
          information mentioned earlier). Objects will also shadow themselves, 
          something that is not easily done with texture-mapping techniques, due 
          to the intensive computations and the number of texture passes that 
          are necessary.</font></p>
        <p><font face="Arial, Helvetica, sans-serif">Reducing the number of texture 
          passes required for a scene is another large benefit of the shadow casting 
          method. With texture-based shadows, as described in earlier articles 
          in this publication, the number of texture modifications and renders 
          needed to shadow a well-populated scene becomes excessive and unbearably 
          complex. Hardware graphics accelerators are unpredictable in their texture-rendering 
          performance across different chipsets. The shadow-casting method is 
          more fill limited, a metric that is more easily understood when coding 
          for the widest range of accelerators.</font></p>
        <p><font face="Arial, Helvetica, sans-serif">For all its benefits, shadow 
          casting also has a dark side (this time, the pun was initially unintentional), 
          as many new technologies do. The foremost problem is the reliance upon 
          8-bit stencil support on the graphics hardware. This factor was especially 
          significant at the time the sample code was originally written. Looking 
          towards the future, however, we predict that 8-bit stencil support will 
          become standard within the next hardware generation. Card fill rate 
          also ranks as an important concern, as the number of polygons that must 
          be manipulated rises dramatically with shadow casting. Shadow rendering 
          can easily become the application bottleneck. The only upside to this 
          is that more CPU cycles can be spent in other application areas without 
          affecting frame rate beyond the shadow bottleneck.</font></p>
        <p><font face="Arial, Helvetica, sans-serif">A smaller concern is the 
          generation of 'sharp' shadows as a by-product of the technique itself. 
          Since shadows are generated by polygonal edges, they are perfectly crisp 
          on their boundary. In many situations, 'soft' shadows that either attenuate 
          or dither at the edges provide a more pleasing complement to the lighting 
          in a scene. Since the actual polygon rendering is performed blindly 
          across the entire screen, these kinds of softening operations are extremely 
          difficult to perform and slow down processing considerably (to the point 
          of being impractical to implement). Also, if an object is either extremely 
          detailed or very small on the screen, the shadow cone polygons can become 
          single pixel width or smaller. This causes visual anomalies onscreen 
          in the form of gaps or shadow flickering. </font></p>
        <p><font face="Arial, Helvetica, sans-serif">The last potential problem 
          with shadow casting involves the complexities of advanced scene management, 
          particularly in cases where more than simple overhead lights are used 
          (note that most shadow casting demos only show the simple case). The 
          next section addresses this issue and other problems in more detail, 
          with some suggestions on how to alleviate potential issues.</font></p>
        <p></p>
        <p align="right"><img src="../../db_area/images/layout/99_icon_arrow.gif" width="6" height="9"><a href="bestimt_freitag_03.htm"><font face="Arial, Helvetica, sans-serif" size="-1"><b>The 
          Path to Enlightenment</b></font></a></p>
      </div>
      <!-- #EndEditable --> </td>
  </tr> </table><table width="600" border="0" cellpadding="0" cellspacing="0"> 
<tr> <td width="150">&nbsp;</td><td><!-- #BeginLibraryItem "/Library/99_footer.lbi" --> 
<p ALIGN="center"><font face="Arial, Helvetica, sans-serif" size="2"><a href="/"><font color="#800000"><br>
  <br>
  Home</font></a><font color="#800000"> </font>| </font> <FONT FACE="Arial, Helvetica, sans-serif" SIZE="2"> 
  <A HREF="/join/"><FONT COLOR="#800000">Join</FONT></A> | <A HREF="/help/"><FONT COLOR="#800000">Help</FONT></A> 
  | <A HREF="/contact_us/"><FONT COLOR="#800000">Contact Us</FONT></A> | <A HREF="/store/"><FONT COLOR="#800000">Shop</FONT></A> 
  | </FONT><font face="Arial, Helvetica, sans-serif" size="2"><font face="Arial, Helvetica, sans-serif" size="2" color="#800000"><a href="/newswire/">Newswire</a></font><font color="#800000"><br>
  </font><a href="/writers_guidelines/"><font color="#800000">Write for Us</font></a> 
  | <a href="/features/"><font color="#800000">Features</font></a> | <a href="/connection/"><font color="#800000">Connection</font></a> 
  | <a href="/jobsearch/"><font color="#800000">Job Search</font></a> | <a href="/directories/"><font color="#800000">Directories</font></a></font> 
  <BR>

<HR noshade WIDTH="70%" align="center">
<div align="center"><FONT FACE="Arial, Helvetica, sans-serif" SIZE="2"><i>Copyright 
  &copy; 1999-2000 Miller Freeman Inc. All rights reserved.</i></FONT> <BR>
  <BR>
  <IMG SRC="/db_area/images/layout/99game.gif" WIDTH="309" HEIGHT="45" ALT="Miller Freeman Game Group: GDC, GDMag, IGF" border="0" usemap="#mfgamegroup"> 
  <map name="mfgamegroup">
    <area shape="rect" coords="54,0,251,18" href="http://www.mfgame.com/" alt="The Miller Freeman Game Group">
    <area shape="rect" coords="194,20,309,45" href="http://www.indiegames.com/" alt="Independent Games Festival">
    <area shape="rect" coords="119,20,193,45" href="http://www.gdmag.com/" alt="Game Developer Magazine">
    <area shape="rect" coords="1,20,119,45" href="http://www.gdconf.com/" alt="Game Developers Conference">
  </map></div>
<!-- #EndLibraryItem --></td></tr> </table>
</body>
<!-- #EndTemplate --></html>
